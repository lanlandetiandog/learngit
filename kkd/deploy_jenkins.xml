<?xml version="1.0" encoding="GBK"?>
<project name="kkd" default="wartest" basedir=".">
        <property name="src.dir" location="src"/>
        <property name="deploy.dir" location="deploy"/>
        <property name="webroot" location="WebRoot"/>
        <property environment="SystemVariable" />
        <property name="classes.dir" location="${webroot}/WEB-INF/classes" />

        <path id="compile.classpath">
                <fileset dir="${basedir}/compile_lib">
                        <include name="*.jar" />
                </fileset>
                <fileset dir="${basedir}/WebRoot/WEB-INF/lib">
                        <include name="*.jar" />
                </fileset>
        </path>

        <target name="clean">
                <delete dir="${classes.dir}"/>
                <delete>
                    <fileset dir="${deploy.dir}/war-prod" includes="*.war"/>
                </delete>
                <delete>
                    <fileset dir="${deploy.dir}/war-test" includes="*.war"/>
                </delete>
                <delete>
                    <fileset dir="${deploy.dir}/war-uat" includes="*.war"/>
                </delete>
        </target>

        <target name="init" depends="clean">
                <mkdir dir="${classes.dir}" />
        </target>

        <target name="java-compile" depends="init">
                <echo>+ =================================================+</echo>
                <echo>+                                                  +</echo>
                <echo>+               java-compile                       +</echo>
                <echo>+                                                  +</echo>
                <echo>+ =================================================+</echo>
                <javac destdir="${classes.dir}"
                        fork="true"
                        debug="true"
                        includeantruntime="false"
                        memoryMaximumSize="1024m"
                        encoding="UTF-8"
                        classpathref="compile.classpath"
                        executable="${SystemVariable.JAVA_HOME}\bin\javac" >
                        <src path="${src.dir}"/>
                </javac>
                <copy includeemptydirs="false" todir="${classes.dir}">
                        <fileset dir="${src.dir}/" excludes="**/*.java" />
                </copy>
        </target>

        <target name="static">
                <delete file="${deploy.dir}/war-test/static.tar"/>
                <tar destfile="${deploy.dir}/war-test/static.tar" >
                        <tarfileset dir="${basedir}/WebRoot/static" prefix="static/" />
                </tar> 
        </target>

        <target name="static_uat">
                <delete file="${deploy.dir}/war-uat/static.tar"/>
                <tar destfile="${deploy.dir}/war-uat/static.tar" >
                        <tarfileset dir="${basedir}/WebRoot/static" prefix="static/" />
                </tar> 
        </target>
        
        <target name="deploy-staticuat" depends="static_uat">
                <scp sftp="true" trust="true" todir="root:redhat@172.16.78.12:/webroot/www.jkd" file="${deploy.dir}/war-uat/static.tar" />
        </target>

        <target name="warprod" depends="java-compile">
                <copy todir="${classes.dir}" file="${deploy.dir}/conf-prod/application.properties" overwrite="true"/>
                <war destfile="${deploy.dir}/war-prod/kkd.war" webxml="${webroot}/WEB-INF/web.xml" basedir="${webroot}"/>
        </target>

        <target name="wartest" depends="java-compile, static">
                <copy todir="${classes.dir}" file="${deploy.dir}/conf-test/application.properties" overwrite="true"/>
                <war destfile="${deploy.dir}/war-test/kkd_${SystemVariable.SVN_REVISION}.war" webxml="${webroot}/WEB-INF/web.xml" basedir="${webroot}"/>
        </target>

        <target name="waruat" depends="java-compile,deploy-staticuat">
                <copy todir="${classes.dir}" file="${deploy.dir}/conf-uat/application.properties" overwrite="true"/>
                <copy todir="${classes.dir}" file="${deploy.dir}/conf-uat/application-dubbo.xml" overwrite="true"/>
                <war destfile="${deploy.dir}/war-uat/kkd_${SystemVariable.SVN_REVISION}.war" webxml="${webroot}/WEB-INF/web.xml" basedir="${webroot}"/>
        </target>
</project>
                       
